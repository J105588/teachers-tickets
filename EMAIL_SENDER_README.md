# 予約完了メール自動送信システム

## 概要
座席申込ログを監視し、未送信の申込に対して自動的に予約完了メールを送信するシステムです。

## セットアップ手順

### 1. 新しいGASプロジェクトを作成
1. [Google Apps Script](https://script.google.com/) にアクセス
2. 「新しいプロジェクト」をクリック
3. プロジェクト名を「予約完了メール送信システム」などに変更

### 2. コードをコピー
1. `email_sender.gs` の内容をコピー
2. GASエディタに貼り付け
3. 保存（Ctrl+S）

### 3. 権限設定
1. 初回実行時に権限の許可を求められます
2. 「権限を確認」→「詳細」→「（プロジェクト名）に移動（安全ではありません）」
3. 「許可」をクリック

### 4. トリガー設定
1. 左メニューの「トリガー」をクリック
2. 「トリガーを追加」をクリック
3. 以下の設定で作成：
   - 実行する関数: `setupTrigger`
   - イベントソース: 時間主導型
   - 時間ベースのトリガー: 分ベースのタイマー
   - 分の間隔: 1分
4. 保存後、`setupTrigger` 関数を手動実行

## 機能

### メイン機能
- **自動監視**: ログスプレッドシートのI列を監視
- **メール送信**: I列が空の行に対して予約完了メールを送信
- **送信記録**: 送信後、I列に「送信完了」を記録
- **エラーハンドリング**: 送信エラー時は「送信エラー」を記録

### メール内容
- **題名**: 演劇祭整理券申請完了のお知らせ
- **宛先**: [名前]先生
- **内容**:
  - 申請日時
  - クラス（class_selectionで選んだクラス）
  - 時間帯（具体的な公演時間）
  - 担当クラス（学年-組）
  - 氏名
  - 予約座席一覧
  - 整理券として使用可能の案内
  - 問い合わせ先: nzn.engeki5@gmail.com

## 使用方法

### 手動実行
```javascript
// 全未送信分を送信
sendReservationEmails()

// テスト送信（1件のみ）
testSendEmail()
```

### トリガー管理
```javascript
// トリガー設定（5分ごとに実行）
setupTrigger()

// トリガー削除
deleteTrigger()
```

## 設定

### ログスプレッドシートID
```javascript
const LOG_SPREADSHEET_ID = '1GN8FNw9BnLiP9GkihMaQqHlsfyE85k3T5DXKamYhVTw';
```

### シート名
```javascript
const SHEET_NAME = 'ParentApplications';
```

## ログ構造
| 列 | 内容 | 説明 |
|---|---|---|
| A | 学年 | 申込者の学年 |
| B | タイムスタンプ | 申込日時 |
| C | class_selection | class_selection.htmlで選択されたクラス |
| D | ご担当クラス | parent_multi.htmlで入力された担当クラス |
| E | 氏名 | 申込者の氏名 |
| F | メールアドレス | 送信先メールアドレス |
| G | 座席リスト | 予約された座席 |
| H | 時間帯 | 申込時間帯 |
| I | メール送信状況 | 送信完了/送信エラー/空（未送信） |

## 注意事項

1. **Gmail送信制限**: 1日あたりの送信数に制限があります
2. **レート制限**: 送信間隔を1秒空けています
3. **エラー処理**: 送信エラー時もI列に記録されます
4. **重複送信防止**: I列に値がある場合はスキップされます

## トラブルシューティング

### メールが送信されない場合
1. Gmail APIの権限を確認
2. ログスプレッドシートのアクセス権限を確認
3. トリガーが正しく設定されているか確認

### エラーログの確認
1. GASエディタの「実行」→「ログを表示」
2. エラー内容を確認して対応

## カスタマイズ

### メール内容の変更
`sendReservationEmail` 関数内の `body` 変数を編集

### 送信間隔の変更
`setupTrigger` 関数内の `everyMinutes(5)` を変更

### 送信条件の変更
`sendReservationEmails` 関数内の条件分岐を編集
